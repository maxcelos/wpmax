name: Publish Package to npmjs

on:
  push:
    # Triggers the workflow when a tag is pushed
    # E.g., v1.0.0, v0.0.7
    tags:
      - 'v*.*.*'

jobs:
  publish:
    name: Publish to npmjs
    runs-on: ubuntu-latest

    # Configure permissions for the OIDC token
    permissions:
      id-token: write # Required to fetch the OIDC token
      contents: read  # Allows checkout of the repository

    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a stable Node.js version
          cache: 'npm'       # Caches node modules

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ” Publish to npmjs with Trusted Publisher
        # This action automatically detects and uses the OIDC token
        # when a Trusted Publisher is configured on npmjs.com
        uses: JS-DevTools/npm-publish@v3
        with:
          # This is the crucial part: leave the token blank!
          # The JS-DevTools/npm-publish action will automatically
          # use the OIDC mechanism if no explicit token is provided.
          token: ''
          # Alternatively, you can use the standard `npm publish` command:
          # run: npm publish